<!DOCTYPE html>
<html>
  <head>
    <title>LD29</title>
    <meta charset="utf-8">
    <script type="text/javascript" src="phaser.min.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      var game = new Phaser.Game(800, 600, Phaser.AUTO, '', {preload: preload, create: create, update: update});
      var player, cursors, enemies, healthtext;
      function preload() {
        game.load.spritesheet('404boy', '404boy.png', 1200, 1750);
        game.load.image('robot1', 'robot1.png');
      }
      function create() {
        game.physics.startSystem(Phaser.Physics.ARCADE);
        cursors = game.input.keyboard.createCursorKeys();
        player = game.add.sprite(50, 400, '404boy');
        game.physics.arcade.enable(player);
        player.body.collideWorldBounds = true;
        player.body.gravity.y = 700;
        player.health = 100;
        player.scale.setTo(0.05, 0.05);
        player.animations.add('left', [1], 10, true);
        player.animations.add('right', [0], 10, true);
        enemies = game.add.group();
        for (var i = 0; i < 2; i++) {
          var enemy = enemies.create(i * 175 + 175, 0, 'robot1');
          game.physics.arcade.enable(enemy);
          enemy.body.collideWorldBounds = true;
          enemy.body.gravity.y = 1000;
          enemy.body.bounce.y = 0.1;
          enemy.scale.setTo(0.05, 0.05);
        }
        healthtext = game.add.text(16, 16, "HP: "+player.health+"/100", {fontSize:'32px', fill: '#0F0'});
      }
      function update() {
        if (cursors.left.isDown) {
          player.body.velocity.x -= 20;
        }
        if (cursors.right.isDown) {
          player.body.velocity.x += 20;
        }
        if (player.body.velocity.x > 0) {
          player.animations.play('right');
        } else if (player.body.velocity.x < 0) {
          player.animations.play('left');
        }
        enemies.forEachAlive(smashForward, this);
        game.physics.arcade.overlap(player, enemies, damageAndBreak, null, this);
      }
      function smashForward(enemy) {
        enemy.body.velocity.x = -30;
      }
      function damageAndBreak(player, enemy) {
        player.damage(50);
        healthtext.content = "HP: "+ player.health +"/100";
        enemy.kill();
      }
    </script>
  </body>
</html>
